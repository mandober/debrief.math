# Generating series

https://www.youtube.com/playlist?list=PLROOIV7hGpZgJQxySIkWLV9ZHIwd-ps0_


## Generating functions

Generating functions are a tool used to manipulate sequences. Instad of an infinite sequences, we deal with a single function that encodes the sequences. This function does not give us the nth term, rather when expressed as a power series it generates the list of coefficients of the infinite polynomial.
- a power series: 2 + 3x + 5x² + 8x³ + 12x⁴ + …
- corresponding sequence: (2,3,5,8,12,…)

A power series is typically expressed using the sigma notation as the sum of terms all of which have the form `cₙxⁿ`.
- general form of a power series: `c₀ + c₁x + c₂x² + c₃x³ + …` (∞-polynomial)

The sequences generated by a generating series is the sequences of coefficients of infinite polynomial.

- Missing terms have coefficient 0
- Generating sequences starts with `a₀`
- x³/7 has coefficient 1/7
- `x³ + 3` is the same as `3x⁰+0x¹+0x²+1x³`, so the sequence is (3,0,0,1)

We encode sequences as power series because we can then manipulate them like we manipulate series in general; e.g. we can take its limit and shit.

    eˣ = 1 + x + x²/2 + x³/6 + x⁴/24 + ⋯ + xⁿ/n! + ⋯

We can refer to `eˣ` when we want to refer to the coefficients of this series.

A *generating function* is a function that expands into a power series, just like `f(x) = eˣ`. We'd say the sequence `(1, 1, 1/2, 1/6, 1/24, …, 1/n!, …)` has generating function `eˣ`.

## Basic generating function

The generating function for sequence (1, 1, 1, 1, …) is `1 + x + x² + x³ + …` which is just a geometric series with the common ratio equal to `x`. Using the "multiply-align-subtract" technic we can derive a closed formula for this series, `1/(1-x)`.

```js
  S = 1 + x  + x² + x³ + …  // geometric series
x∙S = x + x² + x³ + x⁴ + …  // mult both sides by x

S - x∙S =
 S: 1 + x + x² + x³ + x⁴ + …  // align in order to subtract sequences
xS: -   x + x² + x³ + x⁴ + …  // all term cancel out except first (1)
  = 1
----------------------------------
S(1 - x) = 1
S = 1/(1 - x)

// closed formula repr this geometric series
      1
S = ------  but x ≠ 0 and |x| < 1
    1 - x

  1
------ = 1 + x + x² + x³ + ⋯
1 - x

x=-0.5: 1/(1-(-0.5)) = 1/1+0.5 = 1/1.5 = 0.75
```



## Functions and the sequences they generate

- the sequences of one's is generated by `1/(1-x)`
- the sequences of two's is generated by `2/(1-x)`

The function for generating the sequences of two's is actually derived from the function for generating the sequences of one's - we multiply all terms by 2, as in `2 × 1/(1-x)` and get `2/(1-x)`.

```js
  2
----- = 2 + 2x + 2x² + 2x³ + 2x⁴ + ⋯
1 - x
```

is the expansion of the function which generates the sequences (2,2,2,2,…).

Similarly, to find the generating function for the sequence (3, 9, 27, 81, …), we see it can be obtained by multiplying each term of the sequence (1,3,9,27,…) by 3. Since the function `1/(1-3x)` generates the latter, we can generate the former sequences with `3/(1-3x)`.

How about the sequence `(2, 4, 10, 28, 82, …)`?

The terms are actually 1 more then a power of 3. We could find the generating function by adding the sequence of 1's to the sequence of powers of 3 in term-by-term manner.

```js
  1 + 3 +  9 + 27 + 81 + …   // powers of 3 generating function
+ 1 + 1 +  1 +  1 +  1 + …  // basic generating function
  ------------------------
= 2 + 4 + 10 + 28 + 82 + …


  1       1
----- + ------- = 2 + 4x + 10x² + 28x³ + ⋯
1 - x   1 - 3x

= 1 + x + x² + x³ + ⋯ + 1 + 3x + 9x² + 27x³ + ⋯ =
= (1 + 1) + (1 + 3)x + (1 + 9)x² + (1 + 27)x³ + ⋯ =
= 2 + 4x + 10x² + 28x³ + ⋯
// bingo!
```

## Alternating sequences of ones and zeros

Replacing `x` in the original function by `x²` we get the alternating sequence of 1's and 0's, `(1, 0, 1, 0, 1, 0, …)`.

```js
  1
------ = 1 + (x²)¹ + (x²)² + (x²)³ + ⋯ = 1 + x² + x⁴ + x⁶ + ⋯
1 - x²
```

How could we get `(0, 1, 0, 1, …)`?

Let's first start by shifting the sequence of powers of 3, generated by the function `1/(1-3x)`, so as to get the sequence `(0, 1, 3, 9, 27, 81, …)`. To get 0 out front, we need the generating series to be `x + 3x² + 9x³ + 27x⁴ + ⋯` (so there is no term `x⁰`). Multiplying by `x` has this effect. So the generating function for `(0, 1, 3, 9, 27, 81, …)` is `x × 1/(1-3x) = x/(1-3x)`.

Thus, multiplying by `x` the function `1/(1-x²)`, we get `x/(1-x²)` which generates the alternating sequence that starts with 0, `(0, 1, 0, 1, …)`.

```js
// Alternating sequence starting with 1
sequence: (1, 0, 1, 0, 1, 0, …)
function:
  1
------ = 1x⁰ + 0x¹ + 1x² + 0x³ + 1x⁴ + ⋯ = 1 + x² + x⁴ + x⁶ + ⋯
1 - x²

// Alternating sequence starting with 0 is the
// shifted alternating sequence starting with 1
sequence: (0, 1, 0, 1, 0, …)
function:
  x
------ = 0x⁰ + 1x¹ + 0x² + 1x³ + 0x⁴ + ⋯ = x + x³ + x⁵ + x⁷ + ⋯
1 - x²
```

Adding the last two generating functions should produce the generating function for the sequence of 1's.

```js
1x⁰ + 0x¹ + 1x² + 0x³ + 1x⁴ + ⋯
0x⁰ + 1x¹ + 0x² + 1x³ + 0x⁴ + ⋯

// we know we should get this, but do we really?
  1        x        1
------ + ------ = -----
1 - x²   1 - x²   1 - x

// yes, we do (doo-bee doo)
  1        x       1 + x         1 + x           1
------ + ------ = ------- = ---------------- = -----
1 - x²   1 - x²    1 - x²    (1 + x)(1 - x)    1 - x
```



## Derivatives

If we take a derivative of `1/(1-x)` we get `1/(1-x)²`.

If we differentiate the power series term-by-term we get:

```js
(1 + x + x² + x³ + ⋯)′ = 1 + 2x + 3x² + ⋯

// quotient rule
 d    f     f′g - fg′
---- ---- = ---------
 dx   g        g²

// 1st derivative
f = 1,     f′ = 0
g = 1 - x, g′ = -1

 d     1       0(1-x) - 1(-1)         1
---- ------ = ---------------- = -----------
 dx  1 - x        (1 - x)²        (1 - x)²

// 2nd derivative
(1 + x +  x² +  x³ +   x⁴ +   x⁵ + ⋯)′′ =
(    1 + 2x  + 3x² +  4x³ +  5x⁴ + ⋯)′ =
(        2   + 6x  + 12x² + 20x³ + ⋯ )

f = 1
f′ = 0
g = (1 - x)² = 1 - 2x + x²
g′ = -2 + 2x = 2x - 2

 d       1       0 - (2x - 2)     2 - 2x       2(1 - x)       2
---- -------- = ------------- = ----------- = ---------- = --------
 dx  (1 - x)²    (1 - x)⁴        (1 - x)⁴      (1 - x)⁴    (1 - x)³


   2
-------- = 2 + 6x + 12x² + 20x³ + ⋯
(1 - x)³

// thus when the nominator is 1:
   2               1
-------- ÷ 2 = --------- = 1 + 3x + 6x² + 10x³ + ⋯
(1 - x)³       (1 - x)³
```

- `1/(1-x)²` generates the series for `(1,2,3,…)`
- `2/(1-x)³` generates the series for `(2,6,12,20,…)`
- `1/(1-x)³` generates the series for `(1,3,6,10,…)` triangular numbers (although triangular numbers have T₀ = 0, but here we have a₀ = 1)

**Important note**: the sequences generated by deriving generating functions have indices that are shifted by 1. For example, the sequences produced by the generating function `1/(1-x)²` is `1x⁰ + 2x¹ + 3x² + 4x³ + …`.

```js
1   + 2x  + 3x² + 4x³ + …

  ₀     ₁     ₂     ₃ // are indices of that sequence
1x⁰ + 2x¹ + 3x² + 4x³ + …
1     2     3     4   // are terms of the sequence but
```

## Olympiad level counting (Generating functions)

https://www.youtube.com/watch?v=bOXCLR3Wric&list=TLPQMTQwNDIwMjXQNmltkqtxFw&index=10

>What is the number of subsets of `S = {1..2000}` whose sum is divisible by 5?

Let's start smaller with `S = {1..5}`. 
It has 2⁵ = 32 subsets, of which 8 are divisible by 5.

- S = {1,2,3,4,5}
- 5 elements means 2⁵ = 32 subsets
- 8 subsets have sum 0 or 5 or 10, thus
- 8 subsets have sum divisible by 5
- sums of subsets go from 0 to 15


```js
//(mod 5) ≡ 0     (mod 5) ≡ 1     (mod 5) ≡ 0     (mod 5) ≡ 0     (mod 5) ≡ 0
//          8               6               6               6               6

       {} → 0         {1} → 1         {2} → 2         {3} → 3         {4} → 4
                                                    {1,2} → 3       {1,3} → 4

      {5} → 5       {1,5} → 6       {2,5} → 7       {3,5} → 8       {4,5} → 9
    {1,4} → 5       {2,4} → 6       {3,4} → 7     {1,2,5} → 8     {1,3,5} → 9
    {2,3} → 5     {1,2,3} → 6     {1,2,4} → 7     {1,3,4} → 8     {2,3,4} → 9

  {1,4,5} → 10    {2,4,5} → 11    {3,4,5} → 12  {1,3,4,5} → 13  {2,3,4,5} → 14
  {2,3,5} → 10  {1,2,3,5} → 11  {1,2,4,5} → 12
{1,2,3,4} → 10

{1,2,3,4,5} → 15
```

p(x) = `(1 + xᵏ)` with `k=1..5` we get the polynomial:

```js
p(x) = (1 + x¹)(1 + x²)(1 + x³)(1 + x⁴)(1 + x⁵)
p(x) = 5×1 + ⋯ + x¹x²x³x⁴x⁵
p(x) = 1 + ⋯ + x¹ᐩ²ᐩ³ᐩ⁴ᐩ⁵
p(x) = 1 + ⋯ + x¹⁵
// expands into the series with 16 terms
// each identified by x raised to a power k, where k=0..15

// incorrect seq! there are coefficients other then 1, like 2 and 3
p(x) = x⁰+x¹+x²+x³+x⁴+x⁵+x⁶+x⁷+x⁸+x⁹+x¹⁰+x¹¹+x¹²+x¹³+x¹⁴+x¹⁵
// correct seq: (1,1,1,2,2,3,3,3,3,3,3,2,2,1,1,1) = (1³,2²,3⁶,2²,1³)
p(x) = 1x⁰ + 1x¹ + 1x²
     + 2x³ + 2x⁴
     + 3x⁵ + 3x⁶ + 3x⁷ + 3x⁸ + 3x⁹ + 3x¹⁰
     + 2x¹¹ + 2x¹²
     + 1x¹³ + 1x¹⁴ + 1x¹⁵

unambiguous correspondencies have coefficient 1:
x⁰  ⟼ 0  ⟼ ∅
x¹  ⟼ 1  ⟼ {1}
x²  ⟼ 2  ⟼ {2}
x¹³ ⟼ 13 ⟼ {1,3,4,5}
x¹⁴ ⟼ 14 ⟼ {2,3,4,5}
x¹⁵ ⟼ 15 ⟼ {1,2,3,4,5}


1 + x¹ + x² + x³ + x⁴ + x⁵ + x⁶ + ⋯ + x¹⁵
↓   ↓    ↓    ↓    ↓    ↓              ↓
∅  {1}  {2}  {3}  {4}  {5}            {1,2,3,4,5}

x⁰ ⟼ ∅
x¹ ⟼ {1}
x² ⟼ {2}
x³ ⟼ {3}
x⁴ ⟼ {4}
x⁵ ⟼ {5}
{1,2} ⟻ 

x⁶  = x¹x⁵ = x²x⁴ ⟼ {1,5} ∨ {2,4}
x⁷  = x²x⁵ = x³x⁴ ⟼ {2,5} ∨ {3,4}
x⁸  = x³x⁵ = x¹x²x⁵ = x¹x³x⁴ ⟼ {3,5} ∨ {1,2,5} ∨ {1,3,4}
x⁹  = x⁴x⁵ = x¹x³x⁵ = x²x³x⁴ ⟼ {4,5} ∨ {1,3,5} ∨ {2,3,4}
x¹⁰ = x¹x⁴x⁵ = x²x³x⁵ = x¹x²x³x⁴ ⟼ {1,4,5} ∨ {2,3,5} ∨ {1,2,3,4}
x¹¹ = x²x⁴x⁵ = x¹x²x³x⁵          ⟼ {2,4,5} ∨ {1,2,3,5}
x¹² = x¹x²x⁴x⁵ = x³x⁴x⁵          ⟼ {1,2,4,5} ∨ {3,4,5}
x¹³ = x¹x³x⁴x⁵   ⟼ {1,3,4,5}
x¹⁴ = x²x³x⁴x⁵   ⟼ {2,3,4,5}
x¹⁵ = x¹x²x³x⁴x⁵ ⟼ {1,2,3,4,5}


// 1   = x⁰          ⟼ ∅
// x¹  =             ⟼ {1}
// x²  =             ⟼ {2}
// x³  = x¹x²        ⟼ {3}
// x⁴  = x¹x³        ⟼ {4}
// x⁵  = x¹x⁴ = x²x³ ⟼ {5}
// x⁶  = x¹x⁵ = x²x⁴ ⟼ {1,5} ∨ {2,4}
// x⁷  = x²x⁵ = x³x⁴ ⟼ {2,5} ∨ {3,4}
// x⁸  = x³x⁵ = x¹x²x⁵ = x¹x³x⁴ ⟼ {3,5} ∨ {1,2,5} ∨ {1,3,4}
// x⁹  = x⁴x⁵ = x¹x³x⁵ = x²x³x⁴ ⟼ {4,5} ∨ {1,3,5} ∨ {2,3,4}
// x¹⁰ = x¹x⁴x⁵ = x²x³x⁵ = x¹x²x³x⁴ ⟼ {1,4,5} ∨ {2,3,5} ∨ {1,2,3,4}
// x¹¹ = x²x⁴x⁵ = x¹x²x³x⁵          ⟼ {2,4,5} ∨ {1,2,3,5}
// x¹² = x¹x²x⁴x⁵ = x³x⁴x⁵          ⟼ {1,2,4,5} ∨ {3,4,5}
// x¹³ = x¹x³x⁴x⁵   ⟼ {1,3,4,5}
// x¹⁴ = x²x³x⁴x⁵   ⟼ {2,3,4,5}
// x¹⁵ = x¹x²x³x⁴x⁵ ⟼ {1,2,3,4,5}
```

Now, you might rightfully ask: Where does this polynomial come from? What do polynomials have to do with this problem? What is the variable `x` even supposed to represent right now?

Essentially, `x` is purely a symbol. The only reason we have a polynomial here is because its algebraic expansion completely mirrors the act of constructing these subsets. Plus, importantly, this grouping that we want, where subsets with the same sum are in the same group, happens automatically.

When we expand the expression `p(x)`, it basically comes down to making 5 binary choices. Which term from each of the 5 parenthesized expressions of the form `(1 + xⁱ)` (where i=1..5) do you choose?


If you choose the first term, `1`, from each, that corresponds to the empty set, where we don't choose any of the elements. The empty set is represented by the first term in the series `1 + x¹ + x² + ⋯` (expansion of the polynomial) which is `1` i.e. `x⁰`.

    p(x) = (1 + _)(1 + _)(1 + _)(1 + _)(1 + _) ⟼ ∅ ⟾ 1
    1 + x¹ + x² + x³ + x⁴ + ⋯ + x¹⁵
    ↓
    ∅

Choosing `x¹` term (from the first group) and the `1` terms from the other 4 groups corresponds to `{1}`.

    p(x) = (_ + x¹)(1 + _)(1 + _)(1 + _)(1 + _) ⟼ {1} ⟾ x
    1 + x¹ + x² + x³ + x⁴ + ⋯ + x¹⁵
        ↓
       {1}

Choosing `x²` and `1`'s from other groups corresponds to `{2}`.

    p(x) = (1 + _)(_ + x²)(1 + _)(1 + _)(1 + _) ⟼ {2} ⟾ x²
    1 + x¹ + x² + x³ + x⁴ + ⋯ + x¹⁵
             ↓
            {2}


Choosing `x³` and `1`'s from other groups corresponds to `{3}`.

    p(x) = (1 + _)(1 + _)(1 + x³)(1 + _)(1 + _) ⟼ {3} ⟾ x³
    1 + x¹ + x² + x³ + x⁴ + ⋯ + x¹⁵
                  ↓
                 {3}


Choosing `x⁴` and `1`'s from other groups corresponds to `{4}`.

    p(x) = (1 + _)(1 + _)(1 + _)(1 + x⁴)(1 + _) ⟼ {4} ⟾ x⁴
    1 + x¹ + x² + x³ + x⁴ + ⋯ + x¹⁵
                       ↓
                      {4}


Choosing `x⁵` and `1`'s from other groups corresponds to `{5}`.

    p(x) = (1 + _)(1 + _)(1 + _)(1 + _)(1 + x⁵) ⟼ {5} ⟾ x⁵
    1 + x¹ + x² + x³ + x⁴ + x⁵ + ⋯ + x¹⁵
                            ↓
                           {5}

So far we have these correspondencies:

    1 + x¹ + x² + x³ + x⁴ + x⁵ + ⋯ + x¹⁵
    ↓   ↓    ↓    ↓    ↓    ↓
    ∅  {1}  {2}  {3}  {4}  {5}


Other selections correspond to subsets that contain these "basic" elements, e.g. choosing `x¹` and `x²` and `1` from other groups corresponds to the subset {1, 2}.

    1 + x¹ + x² + x³ + x⁴ + x⁵ + x⁶ + ⋯ + x¹⁵
        ↓    ↓    ↓    ↓    ↓    ↓         ↓
       {1}  {2}  {3}  {4}  {5}   ?         {1,2,3,4,5}



p(x) = (1 + x¹)(1 + x²)(1 + x³)(1 + x⁴)(1 + x⁵)

But notice what happens if we choose `x¹` and `x²` and then `1`'s from everything else. This corresponds to the choice of the subset that has 1 and 2, i.e. `{1,2}`, but in the polynomial, it corresponds to `x³`, since `x¹x² = x³`. 
However, there is already `x³` term in the polynomial corresponding to `{3}`. So we have two different `x³` terms, each of which came from a subset whose sum is 3.

>Every possible subset corresponds to one of the terms in the polynomial expansion.

In the end we deal with generating functions that can be expressed as power series that expand into polynomials where exponents `k` on terms `x` (as in term `cₖxᵏ`) correspond to e.g. totals of various subsets, while the coefficients tell the number of elements in such subsets; e.g. `2x³` could mean there are 2 subsets (of some ambient set) whose sum is 3, like {3} and {1,2}.

## Differencing

We have seen how to find generating functions from `1/(1-x)` using multiplication (by a constant or by `x`), substitution, addition, and differentiation. To use each of these, we must figure out a way to transform the sequence of 1's into the desired sequence.

One thing to consider is the sequence of differences between terms of a sequence, which is also helpful in finding a generating function as well. The sequence of differences is often simpler than the original sequence. If we can figure out the generating function for the differences, we can use it to find a generating function for the original sequence.

The first differences of the sequence `(2,4,10,28,82,…)` are `(2,6,18,54,…)`. If we had the generating function for the former how can we derive the generating function for the latter sequence?

```js
  1, 3,  9, 27, 81, …       // powers of 3

  2, 4, 10, 28, 82, …       // powers of 3 plus 1 (target sequence)
- 0, 2,  4, 10, 28, 82, …
--------------------------
= 2, 2,  6, 18, 54, …

```
